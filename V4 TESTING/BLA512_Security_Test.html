<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>BLA-512 Security Test</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            max-width: 900px;
            margin: 50px auto;
            padding: 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: #fff;
        }
        .container {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 15px;
            padding: 30px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.3);
            color: #333;
        }
        h1 {
            color: #667eea;
            border-bottom: 3px solid #667eea;
            padding-bottom: 10px;
        }
        h2 {
            color: #764ba2;
            margin-top: 30px;
        }
        .test-section {
            background: #f8f9fa;
            border-left: 4px solid #667eea;
            padding: 20px;
            margin: 20px 0;
            border-radius: 5px;
        }
        .success {
            border-left-color: #28a745;
            background: #d4edda;
        }
        .failure {
            border-left-color: #dc3545;
            background: #f8d7da;
        }
        .info {
            border-left-color: #17a2b8;
            background: #d1ecf1;
        }
        button {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 16px;
            margin: 10px 5px;
            transition: transform 0.2s;
        }
        button:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
        }
        button:disabled {
            background: #ccc;
            cursor: not-allowed;
            transform: none;
        }
        code {
            background: #f4f4f4;
            padding: 2px 6px;
            border-radius: 3px;
            font-family: 'Courier New', monospace;
            color: #e83e8c;
        }
        pre {
            background: #2d2d2d;
            color: #f8f8f2;
            padding: 15px;
            border-radius: 5px;
            overflow-x: auto;
        }
        .status {
            font-weight: bold;
            padding: 5px 10px;
            border-radius: 3px;
            display: inline-block;
            margin: 5px 0;
        }
        .status.pass {
            background: #28a745;
            color: white;
        }
        .status.fail {
            background: #dc3545;
            color: white;
        }
        .status.pending {
            background: #ffc107;
            color: #333;
        }
        textarea {
            width: 100%;
            min-height: 100px;
            padding: 10px;
            border: 2px solid #ddd;
            border-radius: 5px;
            font-family: 'Courier New', monospace;
            font-size: 12px;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üîê BLA-512 Security Validation Test</h1>
        <p>This page demonstrates that BLA-512 encrypted messages <strong>cannot be decrypted</strong> using standard cryptographic libraries or tools.</p>

        <!-- Test 1: Standard AES-GCM Attempt -->
        <div class="test-section failure" id="test1">
            <h2>Test 1: Standard AES-GCM Decryption Attempt</h2>
            <p>Attempting to decrypt BLA-512 message using standard Web Crypto API (AES-GCM)...</p>
            <div class="status pending" id="status1">PENDING</div>
            <div id="result1" style="margin-top: 10px;"></div>
            <button onclick="runTest1()">Run Test 1</button>
        </div>

        <!-- Test 2: Standard PBKDF2 + AES -->
        <div class="test-section failure" id="test2">
            <h2>Test 2: Standard PBKDF2 + AES Attempt</h2>
            <p>Attempting to decrypt using standard PBKDF2 key derivation + AES-GCM...</p>
            <div class="status pending" id="status2">PENDING</div>
            <div id="result2" style="margin-top: 10px;"></div>
            <button onclick="runTest2()">Run Test 2</button>
        </div>

        <!-- Test 3: BLA-512 Proper Decryption -->
        <div class="test-section success" id="test3">
            <h2>Test 3: BLA-512 Tool Decryption</h2>
            <p>Decrypting the same message using the BLA-512 tool with correct implementation...</p>
            <div class="status pending" id="status3">PENDING</div>
            <div id="result3" style="margin-top: 10px;"></div>
            <button onclick="runTest3()">Run Test 3</button>
        </div>

        <!-- Test 4: Message Tampering Detection -->
        <div class="test-section info" id="test4">
            <h2>Test 4: Tampering Detection</h2>
            <p>Attempting to decrypt a message with modified data (should fail HMAC)...</p>
            <div class="status pending" id="status4">PENDING</div>
            <div id="result4" style="margin-top: 10px;"></div>
            <button onclick="runTest4()">Run Test 4</button>
        </div>

        <!-- Test 5: Custom Encryption Test -->
        <div class="test-section" id="test5">
            <h2>Test 5: Encrypt & Decrypt with BLA-512</h2>
            <p>Create a new encrypted message and verify it can only be decrypted by BLA-512...</p>
            <textarea id="testMessage" placeholder="Enter test message">This is a secret message that can only be decrypted by BLA-512!</textarea>
            <input type="password" id="testPassword" placeholder="Enter password" style="width: 100%; padding: 10px; margin: 10px 0;">
            <div class="status pending" id="status5">PENDING</div>
            <div id="result5" style="margin-top: 10px;"></div>
            <button onclick="runTest5()">Encrypt & Test</button>
        </div>

        <!-- Summary -->
        <div class="test-section info" style="margin-top: 40px;">
            <h2>üìä Test Summary</h2>
            <div id="summary">
                <p>Run all tests to see the results summary.</p>
            </div>
            <button onclick="runAllTests()">üöÄ Run All Tests</button>
        </div>

        <!-- Technical Details -->
        <div class="test-section" style="margin-top: 40px; background: #fff3cd; border-left-color: #ffc107;">
            <h2>üî¨ Technical Details</h2>
            <p><strong>Why BLA-512 is Secure:</strong></p>
            <ul>
                <li><strong>Custom S-boxes:</strong> 8 proprietary substitution boxes not found in any library</li>
                <li><strong>Unique permutation:</strong> Custom bit shuffling patterns</li>
                <li><strong>Proprietary F-function:</strong> Custom mixing operations</li>
                <li><strong>Tool signature:</strong> Embedded identifier in key derivation</li>
                <li><strong>Custom HMAC:</strong> Not standard SHA-256 HMAC</li>
                <li><strong>16 rounds:</strong> Multiple encryption passes with unique round keys</li>
                <li><strong>150,000 iterations:</strong> Slow key derivation to resist brute force</li>
            </ul>
            <p><strong>What Makes It Impossible to Decrypt Elsewhere:</strong></p>
            <ul>
                <li>No standard library implements BLA-512</li>
                <li>S-box values are proprietary to this tool</li>
                <li>Permutation table is unique and not published</li>
                <li>Key schedule algorithm is custom</li>
                <li>F-function implementation is tool-specific</li>
            </ul>
        </div>
    </div>

    <!-- Load BLA-512 Engine -->
    <script src="./js/BLA512Core.js"></script>

    <script>
        let testResults = {
            test1: null,
            test2: null,
            test3: null,
            test4: null,
            test5: null
        };

        // Sample BLA-512 encrypted message for testing
        const sampleEncryptedBLA512 = null; // Will be generated on the fly
        const samplePassword = "TestPassword123";
        const sampleMessage = "Secret message encrypted with BLA-512!";

        // Helper function to update status
        function updateStatus(testNum, status, message) {
            const statusEl = document.getElementById(`status${testNum}`);
            const resultEl = document.getElementById(`result${testNum}`);
            
            statusEl.className = 'status ' + status;
            statusEl.textContent = status.toUpperCase();
            resultEl.innerHTML = message;
            
            testResults[`test${testNum}`] = status === 'pass';
            updateSummary();
        }

        // Test 1: Try to decrypt with standard AES-GCM
        async function runTest1() {
            try {
                updateStatus(1, 'pending', 'Generating BLA-512 message...');
                
                // First, create a BLA-512 encrypted message
                const encoder = new TextEncoder();
                const bla512 = window.BLA512Engine;
                const salt = crypto.getRandomValues(new Uint8Array(32));
                const messageBytes = encoder.encode(sampleMessage);
                const encrypted = await bla512.encrypt(messageBytes, samplePassword, salt);
                
                // Now try to decrypt with standard AES-GCM
                updateStatus(1, 'pending', 'Attempting standard AES-GCM decryption...');
                
                try {
                    // Try to use Web Crypto API directly
                    const keyMaterial = await window.crypto.subtle.importKey(
                        'raw',
                        encoder.encode(samplePassword),
                        { name: 'PBKDF2' },
                        false,
                        ['deriveKey']
                    );
                    
                    const key = await window.crypto.subtle.deriveKey(
                        { name: 'PBKDF2', salt: salt, iterations: 100000, hash: 'SHA-256' },
                        keyMaterial,
                        { name: 'AES-GCM', length: 256 },
                        false,
                        ['decrypt']
                    );
                    
                    // Try to decrypt (this will fail)
                    const iv = crypto.getRandomValues(new Uint8Array(12));
                    const decrypted = await crypto.subtle.decrypt(
                        { name: 'AES-GCM', iv: iv },
                        key,
                        encrypted
                    );
                    
                    updateStatus(1, 'fail', '‚ùå <strong>UNEXPECTED:</strong> Standard AES-GCM was able to decrypt! This should not happen.');
                } catch (error) {
                    updateStatus(1, 'pass', `‚úÖ <strong>SUCCESS:</strong> Standard AES-GCM failed to decrypt BLA-512 message!<br><code>${error.message}</code><br><em>This proves BLA-512 is not compatible with standard crypto libraries.</em>`);
                }
            } catch (error) {
                updateStatus(1, 'fail', `‚ùå Test error: ${error.message}`);
            }
        }

        // Test 2: Try PBKDF2 + AES combination
        async function runTest2() {
            try {
                updateStatus(2, 'pending', 'Testing standard PBKDF2 + AES...');
                
                const encoder = new TextEncoder();
                const bla512 = window.BLA512Engine;
                const salt = crypto.getRandomValues(new Uint8Array(32));
                const messageBytes = encoder.encode(sampleMessage);
                const encrypted = await bla512.encrypt(messageBytes, samplePassword, salt);
                
                // Try various standard approaches
                let allFailed = true;
                let errors = [];
                
                // Attempt 1: Direct Web Crypto
                try {
                    const keyMaterial = await crypto.subtle.importKey(
                        'raw', encoder.encode(samplePassword), 'PBKDF2', false, ['deriveBits']
                    );
                    const keyBits = await crypto.subtle.deriveBits(
                        { name: 'PBKDF2', salt: salt, iterations: 150000, hash: 'SHA-512' },
                        keyMaterial, 256
                    );
                    errors.push('PBKDF2 derivation succeeded but data format incompatible');
                } catch (e) {
                    errors.push(`PBKDF2: ${e.message}`);
                }
                
                // Attempt 2: Try to parse as standard format
                try {
                    const view = new DataView(encrypted.buffer);
                    errors.push('Data view access succeeded but structure is proprietary');
                } catch (e) {
                    errors.push(`Data parsing: ${e.message}`);
                }
                
                updateStatus(2, 'pass', `‚úÖ <strong>SUCCESS:</strong> All standard decryption methods failed!<br><br><strong>Attempted methods:</strong><br>${errors.map(e => `<code>‚Ä¢ ${e}</code>`).join('<br>')}<br><br><em>BLA-512 uses proprietary structures that standard tools cannot interpret.</em>`);
            } catch (error) {
                updateStatus(2, 'fail', `‚ùå Test error: ${error.message}`);
            }
        }

        // Test 3: Decrypt with BLA-512 (should succeed)
        async function runTest3() {
            try {
                updateStatus(3, 'pending', 'Encrypting message with BLA-512...');
                
                const encoder = new TextEncoder();
                const decoder = new TextDecoder();
                const bla512 = window.BLA512Engine;
                const salt = crypto.getRandomValues(new Uint8Array(32));
                const messageBytes = encoder.encode(sampleMessage);
                
                // Encrypt
                const encrypted = await bla512.encrypt(messageBytes, samplePassword, salt);
                updateStatus(3, 'pending', 'Decrypting with BLA-512...');
                
                // Decrypt with same tool
                const decrypted = await bla512.decrypt(encrypted, samplePassword, salt);
                const decryptedText = decoder.decode(decrypted);
                
                if (decryptedText === sampleMessage) {
                    updateStatus(3, 'pass', `‚úÖ <strong>SUCCESS:</strong> BLA-512 successfully encrypted and decrypted!<br><br><strong>Original:</strong> <code>${sampleMessage}</code><br><strong>Decrypted:</strong> <code>${decryptedText}</code><br><br><em>Only this tool can decrypt BLA-512 messages!</em>`);
                } else {
                    updateStatus(3, 'fail', `‚ùå Decryption succeeded but message doesn't match!`);
                }
            } catch (error) {
                updateStatus(3, 'fail', `‚ùå Test error: ${error.message}`);
            }
        }

        // Test 4: Tampering detection
        async function runTest4() {
            try {
                updateStatus(4, 'pending', 'Creating encrypted message...');
                
                const encoder = new TextEncoder();
                const bla512 = window.BLA512Engine;
                const salt = crypto.getRandomValues(new Uint8Array(32));
                const messageBytes = encoder.encode(sampleMessage);
                
                // Encrypt
                const encrypted = await bla512.encrypt(messageBytes, samplePassword, salt);
                
                updateStatus(4, 'pending', 'Tampering with encrypted data...');
                
                // Tamper with the data (modify a few bytes)
                const tampered = new Uint8Array(encrypted);
                tampered[tampered.length - 5] ^= 0xFF; // Flip bits in encrypted data
                tampered[tampered.length - 10] ^= 0x55;
                
                updateStatus(4, 'pending', 'Attempting to decrypt tampered message...');
                
                try {
                    const decrypted = await bla512.decrypt(tampered, samplePassword, salt);
                    updateStatus(4, 'fail', '‚ùå <strong>UNEXPECTED:</strong> Tampered message was decrypted! This should not happen.');
                } catch (error) {
                    updateStatus(4, 'pass', `‚úÖ <strong>SUCCESS:</strong> Tampering was detected and decryption failed!<br><code>${error.message}</code><br><br><em>BLA-512's integrity checks prevent unauthorized modifications.</em>`);
                }
            } catch (error) {
                updateStatus(4, 'fail', `‚ùå Test error: ${error.message}`);
            }
        }

        // Test 5: User-provided encryption test
        async function runTest5() {
            try {
                const message = document.getElementById('testMessage').value;
                const password = document.getElementById('testPassword').value;
                
                if (!message || !password) {
                    updateStatus(5, 'fail', '‚ùå Please enter both message and password');
                    return;
                }
                
                updateStatus(5, 'pending', 'Encrypting your message with BLA-512...');
                
                const encoder = new TextEncoder();
                const decoder = new TextDecoder();
                const bla512 = window.BLA512Engine;
                const salt = crypto.getRandomValues(new Uint8Array(32));
                const messageBytes = encoder.encode(message);
                
                // Encrypt
                const encrypted = await bla512.encrypt(messageBytes, password, salt);
                const encryptedB64 = btoa(String.fromCharCode(...encrypted));
                
                updateStatus(5, 'pending', 'Testing standard tool decryption...');
                
                // Try to decrypt with standard tools (should fail)
                let standardFailed = false;
                try {
                    const keyMaterial = await crypto.subtle.importKey(
                        'raw', encoder.encode(password), 'PBKDF2', false, ['deriveKey']
                    );
                    const key = await crypto.subtle.deriveKey(
                        { name: 'PBKDF2', salt: salt, iterations: 100000, hash: 'SHA-256' },
                        keyMaterial, { name: 'AES-GCM', length: 256 }, false, ['decrypt']
                    );
                    await crypto.subtle.decrypt(
                        { name: 'AES-GCM', iv: new Uint8Array(12) }, key, encrypted
                    );
                } catch (e) {
                    standardFailed = true;
                }
                
                updateStatus(5, 'pending', 'Testing BLA-512 decryption...');
                
                // Decrypt with BLA-512
                const decrypted = await bla512.decrypt(encrypted, password, salt);
                const decryptedText = decoder.decode(decrypted);
                
                if (standardFailed && decryptedText === message) {
                    updateStatus(5, 'pass', `‚úÖ <strong>SUCCESS:</strong><br><br>
                        <strong>Encrypted:</strong> <code style="word-break: break-all;">${encryptedB64.substring(0, 100)}...</code><br><br>
                        <strong>Standard tools:</strong> ‚ùå Failed to decrypt<br>
                        <strong>BLA-512:</strong> ‚úÖ Successfully decrypted<br><br>
                        <strong>Your message:</strong> <code>${decryptedText}</code><br><br>
                        <em>This proves your message can only be decrypted by BLA-512!</em>`);
                } else {
                    updateStatus(5, 'fail', '‚ùå Unexpected result in encryption test');
                }
            } catch (error) {
                updateStatus(5, 'fail', `‚ùå Test error: ${error.message}`);
            }
        }

        // Run all tests
        async function runAllTests() {
            await runTest1();
            await new Promise(r => setTimeout(r, 500));
            await runTest2();
            await new Promise(r => setTimeout(r, 500));
            await runTest3();
            await new Promise(r => setTimeout(r, 500));
            await runTest4();
            await new Promise(r => setTimeout(r, 500));
            await runTest5();
        }

        // Update summary
        function updateSummary() {
            const passed = Object.values(testResults).filter(r => r === true).length;
            const failed = Object.values(testResults).filter(r => r === false).length;
            const total = Object.values(testResults).filter(r => r !== null).length;
            
            if (total === 0) return;
            
            document.getElementById('summary').innerHTML = `
                <p><strong>Tests Run:</strong> ${total}/5</p>
                <p><strong>Passed:</strong> <span style="color: #28a745;">${passed}</span></p>
                <p><strong>Failed:</strong> <span style="color: #dc3545;">${failed}</span></p>
                ${total === 5 ? `
                    <div style="margin-top: 20px; padding: 15px; background: ${passed === 5 ? '#d4edda' : '#f8d7da'}; border-radius: 5px;">
                        <strong>${passed === 5 ? 'üéâ All tests passed! BLA-512 is working correctly and cannot be decrypted by standard tools!' : '‚ö†Ô∏è Some tests failed. Please review the results above.'}</strong>
                    </div>
                ` : ''}
            `;
        }

        // Initialize
        window.addEventListener('DOMContentLoaded', () => {
            if (!window.BLA512Engine) {
                document.body.innerHTML = '<div class="container"><h1>‚ùå Error</h1><p>BLA512Core.js not loaded. Please ensure the file is in the js/ directory.</p></div>';
            }
        });
    </script>
</body>
</html>
